<div id="show_command">
    <%= link_to t('common.title.back'), :bank_accounts %>
</div>
<h2><%= t(".title")%></h2>

<% newest = BankAccount.newest_transaction %>
<% oldest = BankAccount.oldest_transaction %>

<% period = Time.zone.parse("#{newest.year}-#{newest.month}-01 00:00:00") %>
<table id="list-table">
  <thead>
    <tr>
      <th>날짜</th>
      <th>카드내역</th>
    </tr>
  </thead>
  <tbody>
    <% while period > oldest %>
      <tr>
        <td><%= period.strftime("%Y.%m") %></td>
        <td>
          <table>
            <tr>
              <th>은행명</th>
              <th>계정</th>
              <th>설명</th>
              <th>입금 총액</th>
              <th>출금 총액</th>
              <th>입출금 차액</th>
            </tr>

            <% BankAccount.all.each do |account| %>
              <tr>
                <td><%= account.name %></td>
                <td><%= account.number %></td>
                <td><%= account.note %></td>
                <% transactions = account.bank_transactions.where(transacted_at: period.all_month) %>
                <td><%= number_to_currency transactions.total_in %></td>
                <td><%= number_to_currency transactions.total_out %></td>
                <td><%= number_to_currency transactions.margin %></td>
              </tr>
            <% end %>
            <tr>
              <td>합계</td>
              <td></td>
              <td></td>
              <% transactions = BankTransaction.where(transacted_at: period.all_month) %>
              <td><%= number_to_currency transactions.total_in %></td>
              <td><%= number_to_currency transactions.total_out %></td>
              <td><%= number_to_currency transactions.margin %></td>
            </tr>
          </table>
        </td>
      </tr>
      <% period -= 1.month %>
    <% end %>
  </tbody>
</table>